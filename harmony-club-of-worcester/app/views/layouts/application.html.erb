<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Harmony Club of Worcester</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet" type="text/css" />
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= favicon_link_tag asset_path('favicon.ico') %>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <%= tinymce_assets %>
   <!-- <script type="text/javascript" src="/assets/tinymce.js"></script> -->
    

  </head>

  <body class="bg-primary">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg bg-danger text-uppercase fixed-top" id="mainNav">
      <div class="container">
        <%= link_to "Harmony Club of Worcester", root_path, class: "navbar-brand", id: "navbarTextWhole" %>
        <%= link_to "Harmony Club", root_path, class: "navbar-brand", id: "navbarTextSmall" %>
        <button id="dropdownButton" class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto">
            <!-- Code to go through the sections in the database -->
            <% @sections.each do |section| %>  
              <li class="nav-item dropdown mx-0 mx-lg-1">
              <!-- check if the section has more than one page associated with it -->
                <% if section.pages.first != nil %>
                  <% if section.pages.first.id != section.pages.last.id %>
                    <%= link_to section.title, "#", class: "dropdown-toggle nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown", role: "button", 'aria-expanded': "false", 'data-bs-toggle': "dropdown" %>
                    <ul class="dropdown-menu dropdown-menu-end" aria-label="navbarDropdown">
                      <!-- sort pages associated with a section by the position attribute -->
                      <% section.get_pages().each do |page| %>
                        <!-- only show the page if the visible attribute is true -->
                        
                        <!-- change the type of link depending on what the link is supposed to go to -->
                          <% if page.page_type == "Basic Page"%>
                            <% if page.authenticate == true %>
                              <li class="dropdownBoxes"><%= link_to page.title, auth_site_page_path(id: page.friendly_id), class: "dropdown-item navbarLink" %></li>
                            <% else %>
                              <li class="dropdownBoxes"><%= link_to page.title, web_site_page_path(id: page.friendly_id), class: "dropdown-item navbarLink" %></li>
                            <% end %>
                          <% elsif page.page_type == "Internal URL" %>
                            <li class="dropdownBoxes"><%= link_to page.title, page.destination, class: "dropdown-item navbarLink" %></li>
                          <% elsif page.page_type == "External URL" %>
                            <li class="dropdownBoxes"><%= link_to page.title, page.destination, class: "dropdown-item navbarLink", target: :_blank %></li>
                          <% elsif page.page_type == "PDF" %>
                            <%= link_to page.title, web_pdf_path(page), class: "dropdown-item" %>
                            
                          
                          <% else %>
                            <li class="dropdownBoxes"><a class="dropdown-item navbarLink" href="#"><%= page.title %></a></li>
                          <% end %>
                      <% end %>
                    </ul>
                  <% else %>
                    <!-- if only has one page, change the section from a dropdown to a normal link -->
                    <% if section.pages.first.visible == true %>
                      <% if section.pages.first.page_type == "Basic Page" %>
                        <% if section.pages.first.authenticate == true %>
                          <%= link_to section.title, auth_site_page_path(id: section.pages.first.friendly_id), class: "nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown navbarLink" %>
                        <% else %>
                          <%= link_to section.title, web_site_page_path(id: section.pages.first.friendly_id), class: "nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown navbarLink" %>
                        <% end %>
                      <% elsif section.pages.first.page_type == "Internal URL" %>
                        <%= link_to section.title, section.pages.first.destination, class: "nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown navbarLink" %>
                      <% elsif section.pages.first.page_type == "External URL" %>
                        <%= link_to section.title, section.pages.first.destination, class: "nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown navbarLink", target: :_blank %>
                      <% elsif section.pages.first.page_type == "PDF" %>
                            <%= link_to section.title, web_pdf_path(section.pages.first), class: "nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown navbarLink"%>
                            
                      <% else %>
                        <a class="dropdown-item" href="#"><%= section.title %></a>
                      <% end %>
                    <% end %>
                  <% end %>
                <% else %>
                  <%= link_to section.title, "#", class: "navbarDropdown nav-link text-light py-3 px-0 px-lg-3 rounded text-white navbarLink" %>
                <% end %>
              </li>
            <% end %>
          </ul>
          <ul class="navbar-nav ms-auto">



          <!-- checks if the user is signed in and whether or not they should have access to the control panel-->
            <% if user_signed_in? %>
             <%if @perms%>
             <!-- changes the sign out button to a dropdown to allow a user to access the control panel -->
             <div class="dropdown">
              <%= link_to current_user.email, "#", class: "dropdown-toggle nav-link py-3 px-0 px-lg-3 rounded text-white navbarDropdown", role: "button", 'aria-expanded': "false", 'data-bs-toggle': "dropdown" %>
              <ul class="dropdown-menu dropdown-menu-end" aria-label="navbarDropdown">
                <li class="dropdownBoxes"><%= link_to "Sign Out", destroy_user_session_path, method: :delete, class: "dropdown-item navbarLink" %></li>
                 <div id="border-div" ></div>
                <li><%= link_to "Control Panel", auth_site_panel_url, class: "dropdown-item navbarLink" %></li>
              </ul>
              </div>
              <%else%>
              <!-- shows the user the signout button if they're signed in, but not admin -->
                <li class="nav-link navbarDropdown mx-0 mx-lg-1 navbarLink"> <%= link_to image_tag("matchsignout.png", class: "acc-button", alt:"sign out button"), destroy_user_session_path, method: :delete, class: "nav-link text-light" %>  </li>
              <%end%> 
            <% else %>
            <!-- show the sign in button if they aren't signed in -->
              <li class="nav-link navbarDropdown mx-0 mx-lg-1 navbarLink"> <%= link_to image_tag("matchlogin.png", class: "acc-button", alt:"log in button"), auth_site_panel_path, class: "nav-link text-light" %> </li>
            
            <% end %>
          </ul>
        </div>
      </div>
    </nav>
    <svg xmlns="http://www.w3.org/2000/svg" class="displayNone">
      <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
      </symbol>
      <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
      </symbol>
      <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
      </symbol>
    </svg>
    <div class="container bg-light topPadding pb-2">
      <% if notice != nil %>
        <div class="alert alert-primary d-flex alert-dismissible fade show align-items-center mt-2 noticeStyles" role="alert">
          <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
          <div>
            <b><%= notice %></b>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div> 
      <% end %>
      <% if alert != nil %>
        <div class="alert alert-danger d-flex alert-dismissible fade show align-items-center mt-2 alertStyles" role="alert">
          <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
          <div>
            <b><%= alert %></b>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>
      <% end %>
      <%= yield %>
    </div>

    <!-- Footer -->
    <div class="bg-danger text-light">
      <div class="container">
          <div class="text-center border-bottom border-light p-1">
            <%= link_to "Harmony Club of Worcester | 2022", root_path, class: "text-light text-decoration-none" %>
          </div>
          <div class="row justify-content-center pt-1">
          <% @footer_sections.each do |footer_section| %>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3 text-center">
              <h6 class="d-inline"><%= footer_section.title %></h6>
              <ul class="d-inline footer-list">
              <% footer_section.pages.each do |page| %>
                <li>
                  <% if page.page_type == "Basic Page" %>
                    <% if page.authenticate == true %>
                      <li class="dropdownBoxes"><%= link_to page.title, auth_site_page_path(id: page.friendly_id), class: "footer-link" %></li>
                    <% else %>
                      <li class="dropdownBoxes"><%= link_to page.title, web_site_page_path(id: page.friendly_id), class: "footer-link" %></li>
                    <% end %>
                  <% elsif page.page_type == "Internal URL" %>
                    <%= link_to page.title, page.destination, class: "footer-link" %>
                  <% elsif page.page_type == "External URL" %>
                    <%= link_to page.title, page.destination, class: "footer-link", target: :_blank %>
                  <% end %>
                </li>
              <% end %>
              </ul>
            </div>
          <% end %>
          </div>
      </div>
    </div>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
  
  </body>
</html>
